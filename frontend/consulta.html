<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Consultas y Gestión</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f0f2f5;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .header {
      background-color: #28a745;
      color: white;
      padding: 1rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom-left-radius: 10px;
      border-bottom-right-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .header img {
      height: 50px;
      margin-right: 1rem;
      border-radius: 50%;
    }

    .header-text h1 {
      font-size: 1.8rem;
      font-weight: bold;
    }

    .container {
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
    }

    .card {
      background-color: white;
      padding: 2rem;
      border-radius: 15px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 1000px;
      margin-bottom: 1.5rem;
      overflow-x: auto;
    }

    .btn {
      padding: 0.7rem 1rem;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: bold;
      cursor: pointer;
      margin: 0.25rem;
      transition: background-color 0.3s ease, transform 0.2s ease;
    }

    .btn-primary {
      background-color: #28a745;
      color: white;
    }

    .btn-primary:hover {
      background-color: #218838;
      transform: translateY(-2px);
    }

    .btn-danger {
      background-color: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background-color: #c82333;
      transform: translateY(-2px);
    }

    .hidden {
      display: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    table th, table td {
      padding: 0.5rem;
      border: 1px solid #ddd;
      text-align: left;
    }

    table th {
      background-color: #28a745;
      color: white;
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="flex items-center">
      <img src="../img/logo.jpg" alt="Logo Centro">
      <div class="header-text">
        <h1>Centro de Rehabilitación Especializado</h1>
      </div>
    </div>
    <button id="logoutBtn" class="btn btn-danger">Cerrar Sesión</button>
  </header>

  <main class="container">
    <div class="mb-4">
      <button class="btn btn-primary" onclick="showSection('consultar')">Consultar Paciente</button>
      <button class="btn btn-primary" onclick="showSection('editar')">Editar Paciente</button>
      <button class="btn btn-primary" onclick="showSection('listado')">Lista Pacientes</button>
      <button class="btn btn-primary" onclick="showSection('habitaciones')">Lista Habitaciones</button>
    </div>

    <!-- Consultar Paciente -->
    <section id="consultar" class="card hidden">
      <h2 class="text-xl font-bold mb-4">Consultar Paciente</h2>
      <input type="text" id="consultaId" class="form-input mb-2" placeholder="Ingrese ID Paciente">
      <button class="btn btn-primary" onclick="consultarPaciente()">Buscar</button>
      <div id="consultaResultado" class="mt-4 text-left"></div>
    </section>

    <!-- Editar Paciente -->
    <section id="editar" class="card hidden">
      <h2 class="text-xl font-bold mb-4">Editar Paciente</h2>
      <input type="text" id="ID_PACIENTE" class="form-input mb-2" placeholder="Ingrese ID Paciente">
      <button class="btn btn-primary" onclick="cargarPaciente()">Cargar Datos</button>
      <form id="editarForm" class="mt-4 hidden">
        <div class="form-group">
          <input type="text" id="NOMBRE_COMPLETO" class="form-input mb-2" placeholder="Nombre Completo">
          <input type="text" id="IDENTIFICACION" class="form-input mb-2" placeholder="Identificación">
          <input type="number" id="EDAD" class="form-input mb-2" placeholder="Edad">
          <input type="text" id="GENERO" class="form-input mb-2" placeholder="Género">
          <input type="text" id="DIRECCION" class="form-input mb-2" placeholder="Dirección">
          <input type="text" id="TELEFONO" class="form-input mb-2" placeholder="Teléfono">
          <input type="text" id="ESTADO_CIVIL" class="form-input mb-2" placeholder="Estado Civil">
          <input type="text" id="TIPO_INGRESO" class="form-input mb-2" placeholder="Tipo de Ingreso">
          <input type="text" id="ADICCION_PRINCIPAL" class="form-input mb-2" placeholder="Adicción Principal">
          <textarea id="OBSERVACIONES" class="form-input mb-2" placeholder="Observaciones"></textarea>
        </div>
        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
      </form>
    </section>

    <!-- Lista Pacientes -->
    <section id="listado" class="card hidden">
      <h2 class="text-xl font-bold mb-4">Lista de Pacientes</h2>
      <button class="btn btn-primary mb-2" onclick="cargarListaPacientes()">Cargar Lista</button>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Edad</th>
            <th>Identificación</th>
          </tr>
        </thead>
        <tbody id="tablaPacientes"></tbody>
      </table>
    </section>

    <!-- Lista Habitaciones -->
    <section id="habitaciones" class="card hidden">
      <h2 class="text-xl font-bold mb-4">Lista de Habitaciones</h2>
      <button class="btn btn-primary mb-2" onclick="cargarListaHabitaciones()">Cargar Lista</button>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Número</th>
            <th>Tipo</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody id="tablaHabitaciones"></tbody>
      </table>
    </section>
   </main>

  <!-- Botón Volver al Menú -->
  <div class="text-center mb-6">
    <button class="btn btn-primary" onclick="window.location.href='menu.html'">Volver al Menú</button>
  </div>

  <script>
    
    function showSection(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
    }

    async function consultarPaciente() {
      const id = consultaId.value;
      const res = await fetch(`http://localhost:5000/pacientes/${id}`);
      const data = await res.json();
      consultaResultado.innerHTML = data.map(p => `
        <p><b>Nombre:</b> ${p.NOMBRE_COMPLETO}</p>j
        <p><b>Edad:</b> ${p.EDAD}</p>
        <p><b>Identificación:</b> ${p.IDENTIFICACION}</p>
      `).join('');
    }

    async function cargarPaciente() {
      const id = ID_PACIENTE.value;
      const res = await fetch(`http://localhost:5000/pacientes/${id}`);
      const data = await res.json();
      const paciente = data[0];
      console.log(data);
      NOMBRE_COMPLETO.value = paciente.NOMBRE_COMPLETO;
      IDENTIFICACION.value = paciente.IDENTIFICACION;
      EDAD.value = paciente.EDAD;
      GENERO.value = paciente.GENERO;
      DIRECCION.value = paciente.DIRECCION;
      TELEFONO.value = paciente.TELEFONO;
      ESTADO_CIVIL.value = paciente.ESTADO_CIVIL;
      TIPO_INGRESO.value = paciente.TIPO_INGRESO;
      ADICCION_PRINCIPAL.value = paciente.ADICCION_PRINCIPAL;
      OBSERVACIONES.value = paciente.OBSERVACIONES;
      editarForm.classList.remove('hidden');
    }

    editarForm.addEventListener('submit', async e => {
      e.preventDefault();
      const id = ID_PACIENTE.value;
      const data = {
        NOMBRE_COMPLETO: NOMBRE_COMPLETO.value,
        IDENTIFICACION: IDENTIFICACION.value,
        EDAD: EDAD.value,
        GENERO: GENERO.value,
        DIRECCION: DIRECCION.value,
        TELEFONO: TELEFONO.value,
        ESTADO_CIVIL: ESTADO_CIVIL.value,
        TIPO_INGRESO: TIPO_INGRESO.value,
        ADICCION_PRINCIPAL: ADICCION_PRINCIPAL.value,
        OBSERVACIONES: OBSERVACIONES.value
      };
      await fetch(`http://localhost:5000/pacientes/${id}`, {
        method: 'PUT',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });
      alert('Cambios guardados');
    });

    async function cargarListaPacientes() {
      const res = await fetch('http://localhost:5000/pacientes');
      const pacientes = await res.json();
      tablaPacientes.innerHTML = pacientes.map(p =>
        `<tr>
          <td>${p.ID_PACIENTE}</td>
          <td>${p.NOMBRE_COMPLETO}</td>
          <td>${p.EDAD}</td>
          <td>${p.IDENTIFICACION}</td>
        </tr>`
      ).join('');
    }

    async function cargarListaHabitaciones() {
      const res = await fetch('http://localhost:5000/habitaciones');
      const habitaciones = await res.json();
      tablaHabitaciones.innerHTML = habitaciones.map(h =>
        `<tr>
          <td>${h.ID_HABITACION}</td>
          <td>${h.NUMERO}</td>
          <td>${h.TIPO}</td>
          <td>${h.ESTADO}</td>
        </tr>`
      ).join('');
    }

    logoutBtn.addEventListener('click', () => {
      window.location.href = 'index.html';
    });
  </script>
</body>
